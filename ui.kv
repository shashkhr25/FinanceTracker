<SharedSummaryRow@BoxLayout>:
	label_text: ""
	amount_text: ""
	orientation: "horizontal"
	size_hint_y: None
	height: dp(36)
	spacing: dp(8)
	padding: [dp(8), 0]
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.55)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [12,12,12,12]
	Label:
		text: root.label_text
		color: rgba("#E2E8F0FF")
		font_size: sp(13)
		bold: True
		valign: "middle"
		text_size: self.size
	Label:
		text: root.amount_text
		color: rgba("#86EFACFF")
		font_size: sp(13)
		bold: True
		valign: "middle"
		halign: "right"
		text_size: self.size

<SavingsInitialDialog@ModalView>:
	size_hint: None, None
	size: dp(320), dp(420)
	auto_dismiss: False
	background_color: 0,0,0,0.4
	parent_screen: None
	savings_input: savings_input
	savings_fd_input: savings_fd_input
	savings_rd_input: savings_rd_input
	savings_gold_input: savings_gold_input
	BoxLayout:
		orientation: "vertical"
		padding: dp(24)
		spacing: dp(16)
		canvas.before:
			Color:
				rgba: rgba("#10172AFF")
			RoundedRectangle:
				pos: self.pos
				size: self.size
				radius: [18,18,18,18]
		Label:
			text: "Initial Savings"
			font_size: sp(20)
			color: rgba("#FFFFFF")
			bold: True
			size_hint_y: None
			height: self.texture_size[1]
		GridLayout:
			cols:2
			spacing: dp(10)
			size_hint_y: None
			height: dp(220)
			row_default_height: dp(48)
			row_force_default: True
			Label:
				text: "Savings"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
			Label:
				text: "Savings FD"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_fd_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
			Label:
				text: "Savings RD"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_rd_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
			Label:
				text: "Savings Gold"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_gold_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
		BoxLayout:
			size_hint_y: None
			height: dp(52)
			spacing: dp(12)
			Button:
				text: "Cancel"
				background_normal: ""
				background_color: rgba("#4B5563FF")
				color: rgba("#FFFFFF")
				on_release: root.dismiss()
			Button:
				text: "Save"
				background_normal: ""
				background_color: rgba("#22C55EFF")
				color: rgba("#FFFFFF")
				on_release: root.handle_save()
#:import rgba kivy.utils.get_color_from_hex
#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp

<AccentButton@Button>:
	size_hint: None,None
	height: dp(44)
	width: dp(160)
	background_normal: ""
	background_color: rgba("#2D3436")
	color:rgba("#FFFFFF")
	font_size: sp(16)
	bold: True
	radius: [22,22,22,22]

<MetricCard@BoxLayout>:
	orientation: "vertical"
	padding: dp(16)
	spacing: dp(6)
	size_hint_y: None
	height: dp(120)
	metric_title: "Metric"
	metric_value: "0.00"
	metric_caption: ""
	bg_color: rgba("#FFFFFF")
	canvas.before:
		Color:
			rgba: root.bg_color if root.bg_color else rgba("#FFFFFF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [18,18,18,18]
	Label:
		text: root.metric_title
		size_hint_y: None
		height: self.texture_size[1]
		color: rgba("#C5CAE9FF")
		font_size: sp(14)
		bold: True
	Label:
		text: root.metric_value
		color: rgba("#FFFFFF")
		font_size: sp(20)
	Label:
		text: root.metric_caption
		color: rgba("#AAB6FEFF")
		font_size: sp(12)


<NavigationDrawer@BoxLayout>:
	orientation: "vertical"
	size_hint_x: None
	width: dp(220)
	padding: dp(20)
	spacing: dp(18)
	canvas.before:
		Color:
			rgba: rgba("#0F172AFF")
		Rectangle:
			pos: self.pos
			size: self.size
	Label:
		text: "MoneyTracker"
		font_size: sp(20)
		color: rgba("#E8EAEDFF")
		bold: True
		size_hint_y: None
		height: self.texture_size[1]
	Widget:
		size_hint_y: None
		height: dp(8)
	Button:
		text: "Dashboard"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "dashboard"
	Button:
		text: "Transactions"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "transactions"
	Button:
		text: "Category Totals"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "category_totals"
	Button:
		text: "Shared Expenses"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "shared_expenses"
	Button:
		text: "Networth"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "networth"
	Button:
		text: "Settings"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "settings"	
	Widget:
		size_hint_y:1

<TopAppBar@BoxLayout>:
	size_hint_y: None
	height: dp(64)
	padding: dp(16)
	spacing: dp(16)
	canvas.before:
		Color:
			rgba: rgba("#0B1020FF")
		Rectangle:
			pos: self.pos
			size: self.size


<AddExpenseDialog@ModalView>:
	size_hint: None, None
	size: dp(360), dp(520)
	auto_dismiss: False
	background_color: 0,0,0,0.4
	parent_screen: None
	amount_input: amount_field
	description_input: description_field
	category_input: category_field
	device_spinner: device_spinner
	date_input: date_field
	shared_checkbox: shared_toggle
	shared_participants_input: shared_participants
	shared_notes_input: shared_notes
	BoxLayout:
		orientation: "vertical"
		padding: dp(24)
		spacing: dp(16)
		canvas.before:
			Color:
				rgba: rgba("#10172AFF")
			RoundedRectangle:
				pos: self.pos
				size: self.size
				radius: [18,18,18,18]
		Label:
			text: "Add Expense"
			font_size: sp(20)
			color: rgba("#FFFFFF")
			bold: True
			size_hint_y: None
			height: self.texture_size[1]
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols: 1
				spacing: dp(12)
				size_hint_y: None
				height: self.minimum_height
				GridLayout:
					cols:2
					spacing: dp(12)
					size_hint_y: None
					height: self.minimum_height
					row_default_height: dp(44)
					row_force_default: True
					Label:
						text: "Amount"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					TextInput:
						id: amount_field
						input_filter: "float"
						hint_text: "0.00"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						on_text_validate: description_field.focus = True
					Label:
						text: "Description"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					TextInput:
						id: description_field
						hint_text: "Optional"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
					Label:
						text: "Category"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					Spinner:
						id: category_field
						text: "Food"
						values: ["Food","Home","Transportation","Personal","Rent","House EMI","Gym","Utilities","Shopping","Petrol","Subscription/Recharge","Book","Credit Card Bill", "Credit Card UPI Bill", "Savings","Savings RD","Savings FD","Savings Gold","Debt Cleared","Others"]
					Label:
						text: "Device"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					Spinner:
						id: device_spinner
						text: "UPI"
						values: ["Cash","UPI","CREDIT_CARD", "CREDIT_CARD_UPI", "DEBT_BORROWED"]
					Label:
						text: "Date"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					TextInput:
						id: date_field
						hint_text: "YYYY-MM-DD"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						write_tab: False
				BoxLayout:
					orientation: "vertical"
					spacing: dp(6)
					padding: [0, dp(4), 0, 0]
					size_hint_y: None
					height: self.minimum_height
					BoxLayout:
						size_hint_y: None
						height: dp(32)
						Label:
							text: "Shared expense?"
							color: rgba("#E2E8F0FF")
							valign: "middle"
							text_size: self.size
						Switch:
							id: shared_toggle
							active: False
							color: rgba("#22C55EFF")
					Label:
						text: "Add participants as comma separated list. Use name:amount for fixed splits."
						color: rgba("#94A3B8FF")
						font_size: sp(11)
						size_hint_y: None
						height: dp(32)
						text_size: self.width, None
						valign: "middle"
					TextInput:
						id: shared_participants
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "e.g. Alex:500, Sam"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						radius: [12,12,12,12]
						size_hint_y: None
						height: dp(44) if shared_toggle.active else 0
						multiline: False
						write_tab: False
					TextInput:
						id: shared_notes
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "Optional notes"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						radius: [12,12,12,12]
						size_hint_y: None
						height: dp(44) if shared_toggle.active else 0
						multiline: False
						write_tab: False
		BoxLayout:
			size_hint_y: None
			height: dp(52)
			spacing: dp(12)
			Button:
				text: "Cancel"
				background_normal: ""
				background_color: rgba("#4B5563FF")
				color: rgba("#FFFFFF")
				on_release: root.dismiss()
			Button:
				text: "Add Expense"
				background_normal: ""
				background_color: rgba("#EF5350FF")
				color: rgba("#FFFFFF")
				on_release: root.handle_submit()

<AddIncomeDialog@ModalView>:
	size_hint: None, None
	size: dp(340), dp(520)
	auto_dismiss: False
	background_color: 0,0,0,0.4
	parent_screen: None
	amount_input: amount_field
	description_input: description_field
	device_spinner: device_spinner
	date_input: date_field
	shared_checkbox: shared_toggle
	shared_participants_input: shared_participants
	shared_notes_input: shared_notes
	BoxLayout:
		orientation: "vertical"
		padding: dp(24)
		spacing: dp(16)
		canvas.before:
			Color:
				rgba: rgba("#10172AFF")
			RoundedRectangle:
				pos: self.pos
				size: self.size
				radius: [18,18,18,18]
		Label:
			text: "Add Income"
			font_size: sp(20)
			color: rgba("#FFFFFF")
			bold: True
			size_hint_y: None
			height: self.texture_size[1]
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols: 1
				spacing: dp(12)
				size_hint_y: None
				height: self.minimum_height
				GridLayout:
					cols:2
					spacing: dp(12)
					size_hint_y: None
					height: dp(220)
					Label:
						text: "Amount"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					TextInput:
						id: amount_field
						input_filter: "float"
						hint_text: "0.00"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						on_text_validate: description_field.focus = True
					Label:
						text: "Description"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					TextInput:
						id: description_field
						hint_text: "Optional"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
					Label:
						text: "Device"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					Spinner:
						id: device_spinner
						text: "Paycheck"
						values: ["Paycheck", "Home", "Personal split paid", "Refund", "Savings Withdraw", "Taken from Savings", "Others"]
					Label:
						text: "Date"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					TextInput:
						id: date_field
						hint_text: "YYYY-MM-DD"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						write_tab: False
				BoxLayout:
					orientation: "vertical"
					spacing: dp(6)
					size_hint_y: None
					height: self.minimum_height
					BoxLayout:
						size_hint_y: None
						height: dp(32)
						Label:
							text: "Received in cash?"
							color: rgba("#E2E8F0FF")
							valign: "middle"
							text_size: self.size
						Switch:
							id: cash_toggle
							active: root.cash_toggle if hasattr(root, 'cash_toggle') else False
							color: rgba("#22C55EFF")
							on_active: root.cash_toggle = self.active
					BoxLayout:
						size_hint_y: None
						height: dp(32)
						Label:
							text: "Shared refund?"
							color: rgba("#E2E8F0FF")
							valign: "middle"
							text_size: self.size
						Switch:
							id: shared_toggle
							active: False
							color: rgba("#22C55EFF")
					Label:
						text: "Participants (comma separated: name or name:amount)"
						color: rgba("#94A3B8FF")
						font_size: sp(11)
						size_hint_y: None
						height: dp(28)
						text_size: self.width, None
						valign: "middle"
					TextInput:
						id: shared_participants
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "e.g. Alex:500, Sam"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						size_hint_y: None
						height: dp(46) if shared_toggle.active else 0
						radius: [12,12,12,12]
						multiline: False
					TextInput:
						id: shared_notes
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "Optional notes (e.g. March groceries)"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						size_hint_y: None
						height: dp(46) if shared_toggle.active else 0
						radius: [12,12,12,12]
		BoxLayout:
			size_hint_y: None
			height: dp(52)
			spacing: dp(12)
			Button:
				text: "Cancel"
				background_normal: ""
				background_color: rgba("#4B5563FF")
				color: rgba("#FFFFFF")
				on_release: root.dismiss()
			Button:
				text: "Add Income"
				background_normal: ""
				background_color: rgba("#EF5350FF")
				color: rgba("#FFFFFF")
				on_release: root.handle_submit()

<GlassCard@BoxLayout>:
	orientation: "vertical"
	padding: dp(16)
	spacing: dp(8)
	size_hint_y: None
	height: max(self.minimum_height, dp(180))
	canvas.before:
		Color:
			rgba: (30/255, 34/255, 45/255, 0.62)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius:[24,24,24,24]

#Themeded dropdown
<ThemedSpinnerDropdown@SpinnerDropdown>:
	background_normal: ""
	background_down: ""
	background_color: 0,0,0,0
	border : (0,0,0,0)
	auto_dismiss: True
	max_height: dp(240)

	canvas.before:
		# Outer subtle shadow
		Color:
			rgba: rgba("#1E293BFF")
		RoundedRectangle:
			pos: self.x - dp(3), self.y - dp(3)
			size: (self.width + dp(6), self.height + dp(6))
			radius: [18,18,18,18]
		# main background
		Color:
			rgba: rgba("#0F172AFF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [14,14,14,14]
		# inner accent
		Color:
			rgba: rgba("#1E293BFF")
		RoundedRectangle:
			pos: self.x + dp(1), self.y + dp(1)
			size: (self.width - dp(2), self.height - dp(2))
			radius: [12,12,12,12]

#Your Spinner 
<Spinner>:
	background_normal: ""
	background_down: ""
	background_color: rgba("#1E293BFF")
	color: rgba("#E2E8F0FF")
	size_hint_y: None
	height: dp(40)
	font_size: sp(14)
	padding: [dp(14), dp(10)]
	border: (0,0,0,0)
	dropdown_cls: 'ThemedSpinnerDropdown'
	option_cls: 'SpinnerOption'
	canvas.before:
		Color:
			rgba: rgba("#1E293BFF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [12,12,12,12]

#Option style
<SpinnerOption@Button>:
	background_normal: ""
	background_down: ""
	background_color: 0,0,0,0
	color: rgba("#E2E8F0FF")	
	font_size: sp(14)
	padding: [dp(16), dp(12)]
	size_hint_y: None
	height: dp(40)
	canvas.before:
		Color:
			rgba: rgba("#334155FF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [10,10,10,10]


<TransactionRow@BoxLayout>:
	transaction_id: ""
	date_text: ""
	category_text: ""
	description_text: ""
	device_text: ""
	amount_text: ""
	amount_color: rgba("#86EFACFF")
	shared_text: ""
	orientation: "horizontal"
	size_hint_y: None
	height: dp(72)
	padding: [dp(16), dp(16), dp(8), dp(16)]
	spacing: dp(12)
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.6)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [16,16,16,16]
	Label:
		text: root.date_text
		size_hint_x: None
		width: dp(90)
		color: rgba("#94A3B8FF")
		font_size: sp(14)
	BoxLayout:
		orientation: "vertical"
		spacing: dp(2)
		Label:
			text: root.category_text
			color: rgba("#E2E8F0FF")
			font_size: sp(16)
			bold: True
			text_size: self.width, None
			halign: "left"
			valigh: "middle"
		Label:	
			text: root.description_text
			color: rgba("#94A3B8FF")
			font_size: sp(12)
			text_size: self.width, None
			halign: "left"
			valign: "middle"
	BoxLayout:
		orientation: "vertical"
		size_hint_x: None
		width: dp(150)
		Label:
			text: root.device_text
			color: rgba("#94A3B8FF")
			font_size: sp(12)
		Label:
			text: root.amount_text
			color: root.amount_color
			font_size: sp(16)
			bold: True
			halign: "right"
			text_size: self.size
			valign: "middle"
		Label:
			text: root.shared_text
			color: rgba("#FACC15FF")
			font_size: sp(11)
			halign: "right"
			text_size: self.size
			valign: "middle"
			opacity: 1 if root.shared_text else 0
	BoxLayout:
		size_hint: None, None
		size: dp(60), dp(24)
		spacing: dp(4)
		Button:
			size_hint: None, None
			size: dp(24), dp(24)
			background_normal: ""
			background_color: 0, 0, 0, 0
			color: rgba("#86EFACFF")
			font_size: sp(16)
			bold: True
			on_release: app.root.get_screen("transactions").edit_transaction(root.transaction_id)
		Button:
			size_hint: None, None
			size: dp(24), dp(24)
			background_normal: ""
			background_color: 0, 0, 0, 0
			color: rgba("#FCA5A5FF")
			text: "-"
			font_size: sp(16)
			bold: True
			on_release: app.root.get_screen("transactions").delete_transaction(root.transaction_id)

<CategorySummaryRow@BoxLayout>:
	category_text: ""
	amount_text: ""
	amount_color: rgba("#FFFFFF")
	budget_text: ""
	variance_text: "0.00"
	variance_color: rgba("#FFFFFF")
	screen_name: "category_totals"
	orientation: "horizontal"
	size_hint_y: None
	height: dp(30)
	padding: [dp(16),dp(12)]
	spacing: dp(16)
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.6)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [14,14,14,14]
	Label:
		text: root.category_text
		color: rgba("#E2E8F0FF")
		font_size: sp(14)
		bold: True
		halign: "left"
		valign: "middle"
		text_size: self.size
		size_hint_x: 0.4
	Label:
		text: root.amount_text
		color: root.amount_color
		font_size: sp(13)
		bold: True
		size_hint_x: 0.2
		halign: "left"
		valign: "middle"
		text_size: self.size
	TextInput:
		size_hint_x: None
		size_hint_y: None
		width: dp(88)
		height: dp(24)
		text: root.budget_text
		hint_text: "Budget"
		background_color: rgba("#1E293BFF")
		foreground_color: rgba("#E2E8F0FF")
		cursor_color: rgba("#38BDF8FF")
		padding: [dp(8), dp(4)]
		radius: [12,12,12,12]
		font_size: sp(12)
		input_filter: "float"
		multiline: False
		write_tab: False
		halign: "center"
		on_focus:	
			(app.root.get_screen(root.screen_name).handle_budget_input(root.category_text, self.text) if app.root and not self.focus else None )
		on_text_validate:
			(app.root.get_screen(root.screen_name).handle_budget_input(root.category_text, self.text) if app.root else None)
	Label:
		text: root.variance_text
		color: root.variance_color
		font_size: sp(13)
		bold: True
		size_hint_x: 0.2
		halign: "right"
		valign: "middle"
		text_size: self.size

<DashboardScreen>:
    name: "dashboard"
    
    BoxLayout:
        orientation: "horizontal"
        spacing: 0
        
        # Navigation Drawer
        NavigationDrawer:
            id: nav_drawer
            size_hint_x: None
            width: dp(280)  # Fixed width, will be adjusted in Python code
            
        # Main Content Area
        BoxLayout:
            orientation: "vertical"
            spacing: 0
            padding: [dp(8), 0, dp(8), 0]  # Add some horizontal padding
            
            # Top App Bar
            BoxLayout:
                size_hint_y: None
                height: dp(64)
                padding: [dp(16), 0, dp(16), 0]
                canvas.before:
                    Color:
                        rgba: rgba("#0F172AFF")  # Dark blue-gray
                    Rectangle:
                        pos: self.pos
                        size: self.size
                
                Label:
                    text: "Dashboard"
                    font_size: sp(20)
                    bold: True
                    color: rgba("#F8FAFCFF")
                    halign: "left"
                    valign: "middle"
                    text_size: self.size
                    padding_x: dp(16)
                
                Widget:  # Spacer
                    size_hint_x: 0.6
                
                # Date/Time Display
                Label:
                    text: root.current_date
                    font_size: sp(14)
                    color: rgba("#94A3B8FF")
                    halign: "right"
                    valign: "middle"
                    text_size: self.size
                    padding_x: dp(16)
            
            # Main Scrollable Content
            ScrollView:
                do_scroll_x: False
                effect_cls: "ScrollEffect"
                bar_width: dp(6)
                bar_color: rgba("#3B82F666")
                bar_inactive_color: rgba("#3B82F633")
                
                BoxLayout:
                    orientation: "vertical"
                    padding: [dp(24), dp(16), dp(24), dp(32)]
                    spacing: dp(24)
                    size_hint_y: None
                    height: self.minimum_height
                    
                    # Top Metrics Row
                    BoxLayout:
                        id: metrics_row
                        orientation: 'horizontal'
                        size_hint_y: None
                        height: dp(140)
                        spacing: dp(8)
                        padding: [dp(8), 0, dp(8), 0]
                        
                        # Balance Card
                        BoxLayout:
                            orientation: "vertical"
                            padding: [dp(16), dp(16)]
                            spacing: dp(8)
                            size_hint_x: 0.33
                            size_hint_y: None
                            height: dp(140)
                            canvas.before:
                                Color:
                                    rgba: rgba("#1E293BFF")
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [16, 16, 16, 16]
                            
                            Label:
                                text: "Current Balance"
                                font_size: sp(14)
                                color: rgba("#94A3B8FF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                            
                            Label:
                                text: root.current_balance_text
                                font_size: sp(32)
                                color: rgba("#F8FAFCFF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                                bold: True
                            
                            Label:
                                text: root.balance_caption
                                font_size: sp(12)
                                color: rgba("#94A3B8FF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                        
                        # Debt Card
                        BoxLayout:
                            orientation: "vertical"
                            padding: [dp(24), dp(20)]
                            spacing: dp(8)
                            canvas.before:
                                Color:
                                    rgba: rgba("#7C3AEDFF")
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [16, 16, 16, 16]
                            
                            Label:
                                text: "Outstanding Debt"
                                font_size: sp(14)
                                color: rgba("#F0E7FEFF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                            
                            Label:
                                text: root.outstanding_debt_text
                                font_size: sp(32)
                                color: rgba("#F8FAFCFF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                                bold: True
                            
                            Label:
                                text: root.outstanding_debt_caption
                                font_size: sp(12)
                                color: rgba("#F0E7FEFF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                        
                        # Credit Card Debt Card
                        BoxLayout:
                            orientation: "vertical"
                            padding: [dp(24), dp(20)]
                            spacing: dp(8)
                            canvas.before:
                                Color:
                                    rgba: rgba("#EF4444FF")
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [16, 16, 16, 16]
                            
                            Label:
                                text: "Credit Card Debt"
                                font_size: sp(14)
                                color: rgba("#FEE2E2FF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                            
                            Label:
                                text: root.credit_card_debt_text
                                font_size: sp(28)
                                color: rgba("#F8FAFCFF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                                bold: True
                            
                            Label:
                                text: root.credit_card_debt_caption
                                font_size: sp(12)
                                color: rgba("#FEE2E2FF")
                                size_hint_y: None
                                height: self.texture_size[1]
                                halign: "left"
                                text_size: self.size
                    
                    # Quick Actions Row
                    BoxLayout:
                        id: quick_actions
                        orientation: 'horizontal'
                        size_hint_y: None
                        height: dp(80)
                        spacing: dp(16)
                        padding: [dp(8), 0, dp(8), 0]
                        
                        # Add Expense Button
                        Button:
                            id: add_expense_btn
                            text: "Add Expense"
                            size_hint_x: 1
                            size_hint_y: None
                            height: dp(60)
                            background_normal: ""
                            background_color: rgba("#EF4444FF")
                            color: rgba("#FFFFFFFF")
                            font_size: sp(16)
                            bold: True
                            on_release: app.root.get_screen("dashboard").open_add_expense()
                            canvas.before:
                                Color:
                                    rgba: (1, 1, 1, 0.1) if self.state == 'down' else (0, 0, 0, 0)
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [12, 12, 12, 12]
                            
                            BoxLayout:
                                orientation: "horizontal"
                                spacing: dp(8)
                                padding: [dp(16), 0]
                                
                                Label:
                                    text: "+ Expense"
                                    font_size: sp(16)
                                    color: rgba("#FFFFFFFF")
                                    bold: True
                                    size_hint_x: None
                                    width: self.texture_size[0]
                                
                                Label:
                                    text: "+"
                                    font_size: sp(20)
                                    color: rgba("#FFFFFFFF")
                                    bold: True
                                    size_hint: None, None
                                    size: dp(24), dp(24)
                        
                        # Add Income Button
                        Button:
                            id: add_income_btn
                            text: "Add Income"
                            size_hint_x: 1
                            size_hint_y: None
                            height: dp(60)
                            background_normal: ""
                            background_color: rgba("#10B981FF")
                            color: rgba("#FFFFFFFF")
                            font_size: sp(16)
                            bold: True
                            on_release: app.root.get_screen("dashboard").open_add_income()
                            canvas.before:
                                Color:
                                    rgba: (1, 1, 1, 0.1) if self.state == 'down' else (0, 0, 0, 0)
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [12, 12, 12, 12]
                            
                            BoxLayout:
                                orientation: "horizontal"
                                spacing: dp(8)
                                padding: [dp(16), 0]
                                
                                Label:
                                    text: "+ Income"
                                    font_size: sp(16)
                                    color: rgba("#FFFFFFFF")
                                    bold: True
                                    size_hint_x: None
                                    width: self.texture_size[0]
                                
                                Label:
                                    text: "+"
                                    font_size: sp(20)
                                    color: rgba("#FFFFFFFF")
                                    bold: True
                                    size_hint: None, None
                                    size: dp(24), dp(24)	


<CategoryTotalsScreen>:
	name: "category_totals"
	category_summary: []
	filter_text_input: filter_text
	filter_month_input: filter_month
	filter_year_input: filter_year
	BoxLayout:
		orientation: "horizontal"
		NavigationDrawer:
		BoxLayout:
			orientation: "vertical"
			canvas.before:
				Color:
					rgba: rgba("#0B1020FF")
				Rectangle:
					pos: self.pos
					size: self.size
			TopAppBar:
				Label:
					text: "Category Totals"
					color: rgba("#fff1d6")
					font_size: sp(20)
					bold: True
					text_size: self.size
					halign: "left"
					valigh: "middle"
			BoxLayout:
				orientation: "vertical"
				padding: [dp(16), dp(8), dp(16), dp(8)]
				spacing: dp(12)
				size_hint_y: None
				height: dp(120)
				BoxLayout:
					size_hint_y: None
					height: dp(44)
					spacing: dp(8)
					TextInput:
						id: filter_text
						hint_text: "Search categories..."
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						radius: [8,8,8,8]
						multiline: False
						size_hint_y: None
						height: dp(44)
						on_text_validate: root.refresh()
				BoxLayout:
					size_hint_y: None
					height: dp(44)
					spacing: dp(8)
					TextInput:
						id: filter_month
						hint_text: "Month (1-12)"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8E0FF")
						padding: dp(12)
						radius: [8,8,8,8]
						size_hint_x: 0.3
						size_hint_y: None
						height: dp(44)
						multiline: False
						on_text_validate: root.refresh()
					TextInput:
						id: filter_year
						hint_text: "Year"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8E0FF")
						padding: dp(12)
						radius: [8,8,8,8]
						size_hint_x: 0.3
						size_hint_y: None
						height: dp(44)
						multiline: False
						on_text_validate: root.refresh()
					Button:
						text: "Clear"
						size_hint_x: 0.4
						size_hint_y: None
						height: dp(44)
						background_color: rgba("#475569FF")
						color: rgba("#FFFFFF")
						on_release: root.clear_filters()
					
			BoxLayout:
				orientation: "vertical"
				padding: dp(10)
				spacing: dp(8)
				RecycleView:
					viewclass: "CategorySummaryRow"
					data: root.category_summary
					scroll_wheel_distance: dp(80)
					scroll_type: ['bars', 'content']
					scroll_timeout: 250
					bar_width: dp(8)
					bar_color: rgba("#4B5563FF")
					bar_inactive_color: rgba("#4B556388")
					bar_margin: dp(2)
					do_scroll_x: False
					do_scroll_y: True
					RecycleBoxLayout:
						default_size: None, dp(50)
						default_size_hint: 1, None
						size_hint_y: None
						height: self.minimum_height
						orientation: "vertical"
						spacing: dp(10)
						padding: [0, 0, dp(16), 0]  # Add right padding for scrollbar


<TransactionsScreen>:
	name: "transactions"
	rv: transactions_rv
	empty_label: empty_level
	filter_text_input: filter_text
	filter_device_input: filter_device
	filter_category_input: filter_category
	BoxLayout:
		orientation: "vertical"
		canvas.before:
			Color:
				rgba: rgba("#0B1020FF")
			Rectangle:
				pos: self.pos
				size: self.size
		TopAppBar:
			Button:
				size_hint:	None, None
				size: dp(44), dp(44)
				text: "<-"
				font_size: sp(20)
				background_normal: ""
				background_color: 0,0,0,0
				color: rgba("#E2E8F0FF")
				on_release: app.root.current = "dashboard"
			Label:
				text: "Transactions"
				color: rgba("#fff1d6")
				font_size: sp(20)
				bold: True
				text_size: self.size
				halign: "left"
				valigh: "middle"
		BoxLayout:
			orientation: "vertical"
			padding: dp(24)
			spacing: dp(16)
			BoxLayout:
				size_hint_y: None
				height: dp(44)
				spacing: dp(12)
				Button:
                    id: sort_button
                    text: "Sort: Newest First"
                    size_hint_x: 0.5
                    background_normal: ""
                    background_color: rgba("#4B5563FF")
                    color: rgba("#E2E8F0FF")
                    on_release: 
                        root.toggle_sort_order()
                        root.update_sort_button_text(self)
				TextInput:
					id: filter_text
					hint_text: "Search description / category / device"
					background_color: rgba("#1E293BFF")
					foreground_color: rgba("#E2E8F0FF")
					padding: dp(12)
					radius: [12,12,12,12]
					multiline: False
					on_text_validate: root.refresh()
				TextInput:
					id: filter_category
					hint_text: "Category"
					background_color: rgba("#1E293BFF")
					foreground_color: rgba("#E2E8F0FF")
					padding: dp(12)
					radius: [12,12,12,12]
					size_hint_x: None
					width: dp(120)
					multiline: False
					on_text_validate: root.refresh()
				TextInput:
					id: filter_device
					hint_text: "Device"
					background_color: rgba("#1E293BFF")
					foreground_color: rgba("#E2E8F0FF")
					padding: dp(12)
					radius: [12,12,12,12]
					size_hint_x: None
					width: dp(110)
					multiline: False
					on_text_validate: root.refresh()
				Button:
					text: "Clear"
					size_hint_x: None
					width: dp(80)
					background_color: rgba("#475569FF")
					color: rgba("#FFFFFF")
					on_release: root.clear_filters()
			Label:
				id: empty_level
				text: "No transactions yet, Add your first expense"
				opacity: 0
				size_hint_y: None
				height: 0
				color: rgba("#94A3B8FF")
				font_size: sp(14)
				halign: "center"
				valigh: "middle"
			RecycleView:
				id: transactions_rv
				viewclass: "TransactionRow"
				bar_width: dp(8)
				bar_color: rgba("#4B5563FF")
				bar_inactive_color: rgba("#4B556388")
				bar_margin: dp(2)
				scroll_type: ['bars', 'content']
				scroll_wheel_distance: dp(80)
				scroll_timeout: 250
				effect_cls: "ScrollEffect"
				do_scroll_x: False
				do_scroll_y: True
				RecycleBoxLayout:
					default_size: None, dp(72)
					default_size_hint: 1, None
					size_hint_y: None
					height: self.minimum_height
					orientation: "vertical"
					spacing: dp(12)
					padding: [0, 0, dp(8), 0]  # Add right padding for scrollbar

<NetWorthScreen>:
    name: "networth"
    BoxLayout:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: rgba("#0B1020FF")
            Rectangle:
                pos: self.pos
                size: self.size
        TopAppBar:
            Button:
                size_hint: None, None
                size: dp(44), dp(44)
                text: "<-"
                font_size: sp(20)
                background_normal: ""
                background_color: 0,0,0,0
                color: rgba("#E2E8F0FF")
                on_release: app.root.current = "dashboard"
            Label:
                text: "Net Worth"
                color: rgba("#fff1d6")
                font_size: sp(20)
                bold: True
                text_size: self.size
                halign: "left"
                valigh: "middle"
        ScrollView:
            do_scroll_x: False
            BoxLayout:
                orientation: "vertical"
                padding: dp(24)
                spacing: dp(16)
                size_hint_y: None
                height: self.minimum_height
                
                # Liquid Balance and Total Debt (top row)
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: dp(160)
                    spacing: dp(18)
                    
                    # Liquid Balance
                    MetricCard:
                        metric_title: "Liquid Balance"
                        metric_value: root.liquid_balance_text
                        metric_caption: root.liquid_balance_caption
                        bg_color: rgba("#1E293BFF")
                    
                    # Credit Card Debt
                    MetricCard:
                        metric_title: "Credit Card Debt"
                        metric_value: root.credit_card_debt_text
                        metric_caption: root.credit_card_debt_caption
                        bg_color: rgba("#7C3AEDFF")
                    # Borrowed Debt
                    MetricCard:
                        metric_title: "Money Owed"
                        metric_value: root.borrowed_debt_text
                        metric_caption: root.borrowed_debt_caption
                        bg_color: rgba("#F59E0BFF")
                
                # Savings Overview (full width)
                MetricCard:
                    size_hint_y: None
                    height: dp(120)
                    metric_title: "Total Savings"
                    metric_value: root.total_savings_text
                    metric_caption: "Combined value of all savings"
                    bg_color: rgba("#1E293BFF")
                
                # Savings Breakdown (2x2 grid)
                GridLayout:
                    cols: 2
                    spacing: dp(16)
                    size_hint_y: None
                    height: dp(240)
                    
                    # Regular Savings
                    MetricCard:
                        metric_title: "Savings Account"
                        metric_value: root.savings_display
                        metric_caption: "Regular savings"
                        bg_color: rgba("#1E293BFF")
                    
                    # Fixed Deposit
                    MetricCard:
                        metric_title: "Fixed Deposit"
                        metric_value: root.savings_fd_display
                        metric_caption: "Fixed deposits"
                        bg_color: rgba("#1E293BFF")
                    
                    # Recurring Deposit
                    MetricCard:
                        metric_title: "Recurring Deposit"
                        metric_value: root.savings_rd_display
                        metric_caption: "RD accounts"
                        bg_color: rgba("#1E293BFF")
                    
                    # Gold
                    MetricCard:
                        metric_title: "Gold"
                        metric_value: root.savings_gold_display
                        metric_caption: "Gold investments"
                        bg_color: rgba("#1E293BFF")

<SettingsScreen>:
	name: "settings"
	initial_balance_input: initial_balance_input
	initial_cash_input: initial_cash_input
	BoxLayout:
		orientation: "vertical"
		canvas.before:
			Color:
				rgba: rgba("#0B1020FF")
			Rectangle:
				pos: self.pos
				size: self.size
		TopAppBar:
		Button:
			size_hint: None, None
			size: dp(44), dp(44)
			text: "<-"
			font_size: sp(20)
			background_normal: ""
			background_color: 0,0,0,0
			color: rgba("#E2E8F0FF")
			on_release: app.root.current = "dashboard"
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols:1 
				size_hint_y: None
				height: self.minimum_height
				padding: dp(24)
				spacing: dp(16)
				GlassCard:
					Label:
						text: "General"
						size_hint_y: None
						height: self.texture_size[1]
						color: rgba("#E0F2FEFF")
						bold: True
					GridLayout:
						cols:2
						spacing: dp(12)
						TextInput:
							id:	initial_balance_input
							multiline: False
							hint_text: "Initial Bank Balance"
							background_color: rgba("#1E293BFF")
							foreground_color: rgba("#E2E8F0FF")
							padding: dp(16)
							radius: [12,12,12,12]
						TextInput:
							id:	initial_cash_input
							hint_text: "Initial Cash Balance"
							background_color: rgba("#1E293BFF")
							foreground_color: rgba("#E2E8F0FF")
							padding: dp(16)
							radius: [12,12,12,12]
							multiline: False
					AnchorLayout:
						size_hint_y: None
						height: dp(44)
						anchor_x: "center"
						Button:
							text: "Save"
							size_hint: None, None
							size: dp(160), dp(44)
							background_color: rgba("#22C55EFF")
							color: rgba("#FFFFFF")
							on_release: root.save_settings()
		
		BoxLayout:
			orientation: "horizontal"
			spacing: dp(12)
			padding: dp(20)
			# Removed Start New Month button
			Button:
				text: "Clear Outstanding Debt"
				size_hint_y: None
				height: dp(44)
				background_normal: ""
				background_color: rgba("#F87171FF")
				color: rgba("#FFFFFF")
				on_release: root.clear_outstanding_debt()
			Button:
				text: "Edit Initial Savings"
				size_hint_y: None
				height: dp(44)
				background_normal: ""
				background_color: rgba("#60A5FAFF")
				color: rgba("#0F172AFF")
				on_release: root.open_initial_savings_dialog()
		

<SharedExpensesScreen>:
    name: "shared_expenses"
    summary_data: []
    detail_data: []
    participant_input: participant_input
    category_input: category_input
    
    BoxLayout:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: rgba("#0F172AFF")
            Rectangle:
                pos: self.pos
                size: self.size
        
        # Header with back button and title
        BoxLayout:
            size_hint_y: None
            height: dp(56)
            padding: [dp(16), 0]
            spacing: dp(16)
            
			Button:
				size_hint:	None, None
				size: dp(44), dp(44)
				text: "<-"
				font_size: sp(20)
				background_normal: ""
				background_color: 0,0,0,0
				color: rgba("#E2E8F0FF")
				on_release: app.root.current = "dashboard"
                canvas.before:
                    Color:
                        rgba: self.background_color
                    RoundedRectangle:
                        pos: self.pos
                        size: self.size
                        radius: [dp(8), dp(8), dp(8), dp(8)]
            
            Label:
                text: "Shared Expenses"
                color: rgba("#F8FAFCFF")
                font_size: sp(18)
                bold: True
                halign: "left"
                valign: "middle"
                text_size: self.size
        
        # Main content area
        ScrollView:
            do_scroll_x: False
            bar_width: dp(4)
            bar_color: rgba("#3B82F6FF")
            
            BoxLayout:
                orientation: "vertical"
                padding: [dp(16), dp(16), dp(16), dp(24)]
                spacing: dp(16)
                size_hint_y: None
                height: self.minimum_height
                
                # Summary cards
                GridLayout:
                    cols: 2
                    spacing: dp(12)
                    size_hint_y: None
                    height: dp(100)
                    
                    BoxLayout:
                        orientation: "vertical"
                        padding: [dp(16), dp(12)]
                        canvas.before:
                            Color:
                                rgba: rgba("#1E293BFF")
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(12), dp(12), dp(12), dp(12)]
                        
                        Label:
                            text: "Total Shared"
                            color: rgba("#94A3B8FF")
                            font_size: sp(13)
                            size_hint_y: None
                            height: dp(20)
                            halign: "left"
                            text_size: self.size
                        
                        Label:
                            text: root.total_shared_text
                            color: rgba("#F8FAFCFF")
                            font_size: sp(20)
                            bold: True
                            size_hint_y: None
                            height: dp(28)
                            halign: "left"
                            text_size: self.size
                    
                    BoxLayout:
                        orientation: "vertical"
                        padding: [dp(16), dp(12)]
                        canvas.before:
                            Color:
                                rgba: rgba("#1E293BFF")
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(12), dp(12), dp(12), dp(12)]
                        
                        Label:
                            text: root.summary_caption
                            color: rgba("#94A3B8FF")
                            font_size: sp(13)
                            size_hint_y: None
                            height: dp(20)
                            halign: "left"
                            text_size: self.size
                        
                        Label:
                            text: root.detail_caption
                            color: rgba("#F8FAFCFF")
                            font_size: sp(20)
                            bold: True
                            size_hint_y: None
                            height: dp(28)
                            halign: "left"
                            text_size: self.size
                
                # Filter section
                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(8)
                    size_hint_y: None
                    height: dp(120)
                    
                    Label:
                        text: "Filter Transactions"
                        color: rgba("#F8FAFCFF")
                        font_size: sp(14)
                        bold: True
                        size_hint_y: None
                        height: dp(20)
                        halign: "left"
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: "horizontal"
                        spacing: dp(12)
                        size_hint_y: None
                        height: dp(48)
                        
                        TextInput:
                            id: participant_input
                            hint_text: "Person"
                            hint_text_color: rgba("#64748BFF")
                            background_color: rgba("#1E293BFF")
                            foreground_color: rgba("#F8FAFCFF")
                            padding: [dp(12), dp(10)]
                            size_hint_x: 0.5
                            multiline: False
                            on_text_validate: root.handle_filter_change()
                            font_size: sp(14)
                            canvas.before:
                                Color:
                                    rgba: rgba("#1E293BFF")
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8), dp(8), dp(8), dp(8)]
                                        
                                Color:
                                    rgba: rgba("#334155FF")
                                Line:
                                    rounded_rectangle: [self.x, self.y, self.width, self.height, 8]
                        
                        TextInput:
                            id: category_input
                            hint_text: "Category"
                            hint_text_color: rgba("#64748BFF")
                            background_color: rgba("#1E293BFF")
                            foreground_color: rgba("#F8FAFCFF")
                            padding: [dp(12), dp(10)]
                            size_hint_x: 0.5
                            multiline: False
                            on_text_validate: root.handle_filter_change()
                            font_size: sp(14)
                            canvas.before:
                                Color:
                                    rgba: rgba("#1E293BFF")
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8), dp(8), dp(8), dp(8)]
                                        
                                Color:
                                    rgba: rgba("#334155FF")
                                Line:
                                    rounded_rectangle: [self.x, self.y, self.width, self.height, 8]
                    
                    BoxLayout:
                        orientation: "horizontal"
                        spacing: dp(12)
                        size_hint_y: None
                        height: dp(40)
                        
                        Button:
                            text: "Clear"
                            size_hint_x: 0.5
                            background_color: rgba("#1E293BFF")
                            color: rgba("#94A3B8FF")
                            font_size: sp(14)
                            on_release: root.clear_filters()
                            canvas.before:
                                Color:
                                    rgba: self.background_color
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8), dp(8), dp(8), dp(8)]
                        
                        Button:
                            text: "Apply Filters"
                            size_hint_x: 0.5
                            background_color: rgba("#3B82F6FF")
                            color: rgba("#FFFFFF")
                            font_size: sp(14)
                            on_release: root.handle_filter_change()
                            canvas.before:
                                Color:
                                    rgba: self.background_color
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(8), dp(8), dp(8), dp(8)]
                
                # Summary section
                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(8)
                    size_hint_y: None
                    height: max(dp(200), self.minimum_height)
                    
                    Label:
                        text: "Per-person Summary"
                        color: rgba("#F8FAFCFF")
                        font_size: sp(14)
                        bold: True
                        size_hint_y: None
                        height: dp(20)
                        halign: "left"
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: "vertical"
                        canvas.before:
                            Color:
                                rgba: rgba("#1E293BFF")
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(12), dp(12), dp(12), dp(12)]
                        
                        RecycleView:
                            viewclass: "SharedSummaryRow"
                            data: root.summary_data
                            bar_width: dp(4)
                            bar_color: rgba("#3B82F6FF")
                            scroll_wheel_distance: dp(80)
                            
                            RecycleBoxLayout:
                                default_size: None, dp(52)
                                default_size_hint: 1, None
                                size_hint_y: None
                                height: self.minimum_height
                                orientation: "vertical"
                                spacing: 0
                
                # Transaction details section
                BoxLayout:
                    orientation: "vertical"
                    spacing: dp(8)
                    size_hint_y: None
                    height: max(dp(300), self.minimum_height)
                    
                    Label:
                        text: "Transaction Details"
                        color: rgba("#F8FAFCFF")
                        font_size: sp(14)
                        bold: True
                        size_hint_y: None
                        height: dp(20)
                        halign: "left"
                        text_size: self.size
                    
                    BoxLayout:
                        orientation: "vertical"
                        canvas.before:
                            Color:
                                rgba: rgba("#1E293BFF")
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(12), dp(12), dp(12), dp(12)]
                        
                        RecycleView:
                            viewclass: "SharedDetailRow"
                            data: root.detail_data
                            bar_width: dp(4)
                            bar_color: rgba("#3B82F6FF")
                            scroll_wheel_distance: dp(80)
                            
                            RecycleBoxLayout:
                                default_size: None, dp(88)
                                default_size_hint: 1, None
                                size_hint_y: None
                                height: self.minimum_height
                                orientation: "vertical"
                                spacing: 0

<SharedDetailRow@BoxLayout>:
    date_text: ""
    category_text: ""
    description_text: ""
    amount_text: ""
    participants_text: ""
    notes_text: ""
    share_text: ""
    orientation: "horizontal"
    size_hint_y: None
    height: dp(72)
    padding: [dp(16), dp(16), dp(8), dp(16)]
    spacing: dp(12)
    canvas.before:
        Color:
            rgba: rgba("#1A202DFF")
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(16), dp(16), dp(16), dp(16)]
    
    # Date
    Label:
        text: root.date_text
        size_hint_x: None
        width: dp(90)
        color: rgba("#94A3B8FF")
        font_size: sp(14)
    
    # Main content
    BoxLayout:
        orientation: "vertical"
        spacing: dp(4)
        
        # Top row - Category and amount
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(24)
            
            # Category
            Label:
                text: root.category_text or "Uncategorized"
                color: rgba("#E2E8F0FF")
                font_size: sp(16)
                bold: True
                text_size: self.width, None
                halign: "left"
                valign: "middle"
                shorten: True
                shorten_from: "right"
            
            # Amount
            Label:
                text: root.amount_text
                color: rgba("#86EFACFF")
                font_size: sp(16)
                bold: True
                text_size: self.size
                halign: "right"
                valign: "middle"
        
        # Middle row - Description
        Label:
            text: root.description_text
            color: rgba("#94A3B8FF")
            font_size: sp(14)
            text_size: self.width, None
            halign: "left"
            valign: "top"
            size_hint_y: None
            height: self.texture_size[1]
            
        # Bottom row - Participants and share (only if exists)
        BoxLayout:
            orientation: "horizontal"
            size_hint_y: None
            height: dp(20) if (root.participants_text or root.share_text) else 0
            
            # Participants
            Label:
                text: root.participants_text
                color: rgba("#94A3B8FF")
                font_size: sp(12)
                text_size: self.width, None
                halign: "left"
                valign: "center"
                shorten: True
                shorten_from: "right"
            
            # Share amount
            Label:
                text: root.share_text
                color: rgba("#86EFACFF")
                font_size: sp(12)
                text_size: self.size
                halign: "right"
                valign: "center"
    
    # Notes (only show if exists)
    Label:
        text: root.notes_text
        color: rgba("#94A3B8FF")
        font_size: sp(12)
        text_size: self.width, None
        halign: "left"
        valign: "top"
        size_hint: None, None
        size: dp(200), self.texture_size[1] if root.notes_text else 0
        opacity: 1 if root.notes_text else 0

MoneyTrackerScreenManager:
	DashboardScreen:
	TransactionsScreen:
	CategoryTotalsScreen:
	SettingsScreen:
	NetWorthScreen:
	SharedExpensesScreen:
