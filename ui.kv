<SharedSummaryRow@BoxLayout>:
	label_text: ""
	amount_text: ""
	orientation: "horizontal"
	size_hint_y: None
	height: dp(36)
	spacing: dp(8)
	padding: [dp(8), 0]
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.55)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [12,12,12,12]
	Label:
		text: root.label_text
		color: rgba("#E2E8F0FF")
		font_size: sp(13)
		bold: True
		valign: "middle"
		text_size: self.size
	Label:
		text: root.amount_text
		color: rgba("#86EFACFF")
		font_size: sp(13)
		bold: True
		valign: "middle"
		halign: "right"
		text_size: self.size

<SavingsInitialDialog@ModalView>:
	size_hint: None, None
	size: dp(320), dp(420)
	auto_dismiss: False
	background_color: 0,0,0,0.4
	parent_screen: None
	savings_input: savings_input
	savings_fd_input: savings_fd_input
	savings_rd_input: savings_rd_input
	savings_gold_input: savings_gold_input
	BoxLayout:
		orientation: "vertical"
		padding: dp(24)
		spacing: dp(16)
		canvas.before:
			Color:
				rgba: rgba("#10172AFF")
			RoundedRectangle:
				pos: self.pos
				size: self.size
				radius: [18,18,18,18]
		Label:
			text: "Initial Savings"
			font_size: sp(20)
			color: rgba("#FFFFFF")
			bold: True
			size_hint_y: None
			height: self.texture_size[1]
		GridLayout:
			cols:2
			spacing: dp(10)
			size_hint_y: None
			height: dp(220)
			row_default_height: dp(48)
			row_force_default: True
			Label:
				text: "Savings"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
			Label:
				text: "Savings FD"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_fd_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
			Label:
				text: "Savings RD"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_rd_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
			Label:
				text: "Savings Gold"
				color: rgba("#E2E8F0FF")
				font_size: sp(14)
				valign: "middle"
				text_size: self.size
			TextInput:
				id: savings_gold_input
				input_filter: "float"
				background_color: rgba("#1E293BFF")
				foreground_color: rgba("#E2E8F0FF")
				cursor_color: rgba("#38BDF8FF")
				padding: [dp(12), dp(10)]
				radius: [12,12,12,12]
				size_hint_y: None
				height: dp(44)
				multiline: False
				write_tab: False
		BoxLayout:
			size_hint_y: None
			height: dp(52)
			spacing: dp(12)
			Button:
				text: "Cancel"
				background_normal: ""
				background_color: rgba("#4B5563FF")
				color: rgba("#FFFFFF")
				on_release: root.dismiss()
			Button:
				text: "Save"
				background_normal: ""
				background_color: rgba("#22C55EFF")
				color: rgba("#FFFFFF")
				on_release: root.handle_save()
#:import rgba kivy.utils.get_color_from_hex
#:import dp kivy.metrics.dp
#:import sp kivy.metrics.sp

<AccentButton@Button>:
	size_hint: None,None
	height: dp(44)
	width: dp(160)
	background_normal: ""
	background_color: rgba("#2D3436")
	color:rgba("#FFFFFF")
	font_size: sp(16)
	bold: True
	radius: [22,22,22,22]

<MetricCard@BoxLayout>:
	orientation: "vertical"
	padding: dp(16)
	spacing: dp(6)
	size_hint_y: None
	height: dp(120)
	metric_title: "Metric"
	metric_value: "0.00"
	metric_caption: ""
	bg_color: rgba("#FFFFFF")
	canvas.before:
		Color:
			rgba: root.bg_color if root.bg_color else rgba("#FFFFFF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [18,18,18,18]
	Label:
		text: root.metric_title
		size_hint_y: None
		height: self.texture_size[1]
		color: rgba("#C5CAE9FF")
		font_size: sp(14)
		bold: True
	Label:
		text: root.metric_value
		color: rgba("#FFFFFF")
		font_size: sp(20)
	Label:
		text: root.metric_caption
		color: rgba("#AAB6FEFF")
		font_size: sp(12)


<NavigationDrawer@BoxLayout>:
	orientation: "vertical"
	size_hint_x: None
	width: dp(220)
	padding: dp(20)
	spacing: dp(18)
	canvas.before:
		Color:
			rgba: rgba("#0F172AFF")
		Rectangle:
			pos: self.pos
			size: self.size
	Label:
		text: "MoneyTracker"
		font_size: sp(20)
		color: rgba("#E8EAEDFF")
		bold: True
		size_hint_y: None
		height: self.texture_size[1]
	Widget:
		size_hint_y: None
		height: dp(8)
	Button:
		text: "Dashboard"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "dashboard"
	Button:
		text: "Transactions"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "transactions"
	Button:
		text: "Category Totals"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "category_totals"
	Button:
		text: "Shared Expenses"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "shared_expenses"
	Button:
		text: "Networth"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "networth"
	Button:
		text: "Settings"
		background_normal: ""
		background_color: 0,0,0,0
		color: rgba("#FFFFFF")
		on_release: app.root.current = "settings"	
	Widget:
		size_hint_y:1

<TopAppBar@BoxLayout>:
	size_hint_y: None
	height: dp(64)
	padding: dp(16)
	spacing: dp(16)
	canvas.before:
		Color:
			rgba: rgba("#0B1020FF")
		Rectangle:
			pos: self.pos
			size: self.size


<AddExpenseDialog@ModalView>:
	size_hint: None, None
	size: dp(360), dp(520)
	auto_dismiss: False
	background_color: 0,0,0,0.4
	parent_screen: None
	amount_input: amount_field
	description_input: description_field
	category_input: category_field
	device_spinner: device_spinner
	date_input: date_field
	shared_checkbox: shared_toggle
	shared_participants_input: shared_participants
	shared_notes_input: shared_notes
	BoxLayout:
		orientation: "vertical"
		padding: dp(24)
		spacing: dp(16)
		canvas.before:
			Color:
				rgba: rgba("#10172AFF")
			RoundedRectangle:
				pos: self.pos
				size: self.size
				radius: [18,18,18,18]
		Label:
			text: "Add Expense"
			font_size: sp(20)
			color: rgba("#FFFFFF")
			bold: True
			size_hint_y: None
			height: self.texture_size[1]
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols: 1
				spacing: dp(12)
				size_hint_y: None
				height: self.minimum_height
				GridLayout:
					cols:2
					spacing: dp(12)
					size_hint_y: None
					height: self.minimum_height
					row_default_height: dp(44)
					row_force_default: True
					Label:
						text: "Amount"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					TextInput:
						id: amount_field
						input_filter: "float"
						hint_text: "0.00"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						on_text_validate: description_field.focus = True
					Label:
						text: "Description"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					TextInput:
						id: description_field
						hint_text: "Optional"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
					Label:
						text: "Category"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					Spinner:
						id: category_field
						text: "Food"
						values: ["Food","Home","Transportation","Personal","Rent","House EMI","Gym","Utilities","Shopping","Petrol","Subscription/Recharge","Book","Credit Card Bill", "Credit Card UPI Bill", "Savings","Savings RD","Savings FD","Savings Gold","Others"]
					Label:
						text: "Device"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					Spinner:
						id: device_spinner
						text: "UPI"
						values: ["Cash","UPI","CREDIT_CARD", "CREDIT_CARD_UPI"]
					Label:
						text: "Date"
						color: rgba("#E2E8F0FF")
						valign: "middle"
						text_size: self.size
					TextInput:
						id: date_field
						hint_text: "YYYY-MM-DD"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						write_tab: False
				BoxLayout:
					orientation: "vertical"
					spacing: dp(6)
					padding: [0, dp(4), 0, 0]
					size_hint_y: None
					height: self.minimum_height
					BoxLayout:
						size_hint_y: None
						height: dp(32)
						Label:
							text: "Shared expense?"
							color: rgba("#E2E8F0FF")
							valign: "middle"
							text_size: self.size
						Switch:
							id: shared_toggle
							active: False
							color: rgba("#22C55EFF")
					Label:
						text: "Add participants as comma separated list. Use name:amount for fixed splits."
						color: rgba("#94A3B8FF")
						font_size: sp(11)
						size_hint_y: None
						height: dp(32)
						text_size: self.width, None
						valign: "middle"
					TextInput:
						id: shared_participants
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "e.g. Alex:500, Sam"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						radius: [12,12,12,12]
						size_hint_y: None
						height: dp(44) if shared_toggle.active else 0
						multiline: False
						write_tab: False
					TextInput:
						id: shared_notes
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "Optional notes"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						radius: [12,12,12,12]
						size_hint_y: None
						height: dp(44) if shared_toggle.active else 0
						multiline: False
						write_tab: False
		BoxLayout:
			size_hint_y: None
			height: dp(52)
			spacing: dp(12)
			Button:
				text: "Cancel"
				background_normal: ""
				background_color: rgba("#4B5563FF")
				color: rgba("#FFFFFF")
				on_release: root.dismiss()
			Button:
				text: "Add Expense"
				background_normal: ""
				background_color: rgba("#EF5350FF")
				color: rgba("#FFFFFF")
				on_release: root.handle_submit()

<AddIncomeDialog@ModalView>:
	size_hint: None, None
	size: dp(340), dp(520)
	auto_dismiss: False
	background_color: 0,0,0,0.4
	parent_screen: None
	amount_input: amount_field
	description_input: description_field
	device_spinner: device_spinner
	date_input: date_field
	shared_checkbox: shared_toggle
	shared_participants_input: shared_participants
	shared_notes_input: shared_notes
	BoxLayout:
		orientation: "vertical"
		padding: dp(24)
		spacing: dp(16)
		canvas.before:
			Color:
				rgba: rgba("#10172AFF")
			RoundedRectangle:
				pos: self.pos
				size: self.size
				radius: [18,18,18,18]
		Label:
			text: "Add Income"
			font_size: sp(20)
			color: rgba("#FFFFFF")
			bold: True
			size_hint_y: None
			height: self.texture_size[1]
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols: 1
				spacing: dp(12)
				size_hint_y: None
				height: self.minimum_height
				GridLayout:
					cols:2
					spacing: dp(12)
					size_hint_y: None
					height: dp(220)
					Label:
						text: "Amount"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					TextInput:
						id: amount_field
						input_filter: "float"
						hint_text: "0.00"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						on_text_validate: description_field.focus = True
					Label:
						text: "Description"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					TextInput:
						id: description_field
						hint_text: "Optional"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
					Label:
						text: "Device"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					Spinner:
						id: device_spinner
						text: "Paycheck"
						values: ["Paycheck", "Home", "Personal split paid", "Refund", "Savings Withdraw", "Taken from Savings", "Others"]
					Label:
						text: "Date"
						color: rgba("#E2E8F0FF")
						size_hint_y: None
						height: dp(32)
					TextInput:
						id: date_field
						hint_text: "YYYY-MM-DD"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0ff")
						padding: dp(12)
						radius: [12,12,12,12]
						multiline: False
						write_tab: False
				BoxLayout:
					orientation: "vertical"
					spacing: dp(6)
					size_hint_y: None
					height: self.minimum_height
					BoxLayout:
						size_hint_y: None
						height: dp(32)
						Label:
							text: "Shared refund?"
							color: rgba("#E2E8F0FF")
							valign: "middle"
							text_size: self.size
						Switch:
							id: shared_toggle
							active: False
							color: rgba("#22C55EFF")
					Label:
						text: "Participants (comma separated: name or name:amount)"
						color: rgba("#94A3B8FF")
						font_size: sp(11)
						size_hint_y: None
						height: dp(28)
						text_size: self.width, None
						valign: "middle"
					TextInput:
						id: shared_participants
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "e.g. Alex:500, Sam"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						size_hint_y: None
						height: dp(46) if shared_toggle.active else 0
						radius: [12,12,12,12]
						multiline: False
					TextInput:
						id: shared_notes
						disabled: not shared_toggle.active
						opacity: 1 if shared_toggle.active else 0
						hint_text: "Optional notes (e.g. March groceries)"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: dp(12)
						size_hint_y: None
						height: dp(46) if shared_toggle.active else 0
						radius: [12,12,12,12]
		BoxLayout:
			size_hint_y: None
			height: dp(52)
			spacing: dp(12)
			Button:
				text: "Cancel"
				background_normal: ""
				background_color: rgba("#4B5563FF")
				color: rgba("#FFFFFF")
				on_release: root.dismiss()
			Button:
				text: "Add Income"
				background_normal: ""
				background_color: rgba("#EF5350FF")
				color: rgba("#FFFFFF")
				on_release: root.handle_submit()

<GlassCard@BoxLayout>:
	orientation: "vertical"
	padding: dp(16)
	spacing: dp(8)
	size_hint_y: None
	height: max(self.minimum_height, dp(180))
	canvas.before:
		Color:
			rgba: (30/255, 34/255, 45/255, 0.62)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius:[24,24,24,24]

#Themeded dropdown
<ThemedSpinnerDropdown@SpinnerDropdown>:
	background_normal: ""
	background_down: ""
	background_color: 0,0,0,0
	border : (0,0,0,0)
	auto_dismiss: True
	max_height: dp(240)

	canvas.before:
		# Outer subtle shadow
		Color:
			rgba: rgba("#1E293BFF")
		RoundedRectangle:
			pos: self.x - dp(3), self.y - dp(3)
			size: (self.width + dp(6), self.height + dp(6))
			radius: [18,18,18,18]
		# main background
		Color:
			rgba: rgba("#0F172AFF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [14,14,14,14]
		# inner accent
		Color:
			rgba: rgba("#1E293BFF")
		RoundedRectangle:
			pos: self.x + dp(1), self.y + dp(1)
			size: (self.width - dp(2), self.height - dp(2))
			radius: [12,12,12,12]

#Your Spinner 
<Spinner>:
	background_normal: ""
	background_down: ""
	background_color: rgba("#1E293BFF")
	color: rgba("#E2E8F0FF")
	size_hint_y: None
	height: dp(40)
	font_size: sp(14)
	padding: [dp(14), dp(10)]
	border: (0,0,0,0)
	dropdown_cls: 'ThemedSpinnerDropdown'
	option_cls: 'SpinnerOption'
	canvas.before:
		Color:
			rgba: rgba("#1E293BFF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [12,12,12,12]

#Option style
<SpinnerOption@Button>:
	background_normal: ""
	background_down: ""
	background_color: 0,0,0,0
	color: rgba("#E2E8F0FF")	
	font_size: sp(14)
	padding: [dp(16), dp(12)]
	size_hint_y: None
	height: dp(40)
	canvas.before:
		Color:
			rgba: rgba("#334155FF")
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [10,10,10,10]


<TransactionRow@BoxLayout>:
	date_text : ""
	category_text: ""
	description_text: ""
	device_text: ""
	amount_text: ""
	amount_color: rgba("#86EFACFF")
	shared_text: ""
	orientation: "horizontal"
	size_hint_y: None
	height: dp(72)
	padding: dp(16)
	spacing: dp(16)
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.6)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [16,16,16,16]
	Label:
		text: root.date_text
		size_hint_x: None
		width: dp(90)
		color: rgba("#94A3B8FF")
		font_size: sp(14)
	BoxLayout:
		orientation: "vertical"
		spacing: dp(2)
		Label:
			text: root.category_text
			color: rgba("#E2E8F0FF")
			font_size: sp(16)
			bold: True
			text_size: self.width, None
			halign: "left"
			valigh: "middle"
		Label:	
			text: root.description_text
			color: rgba("#94A3B8FF")
			font_size: sp(12)
			text_size: self.width, None
			halign: "left"
			valign: "middle"
	BoxLayout:
		orientation: "vertical"
		size_hint_x: None
		width: dp(150)
		Label:
			text: root.device_text
			color: rgba("#94A3B8FF")
			font_size: sp(12)
		Label:
			text: root.amount_text
			color: root.amount_color
			font_size: sp(16)
			bold: True
			halign: "right"
			text_size: self.size
			valign: "middle"
		Label:
			text: root.shared_text
			color: rgba("#FACC15FF")
			font_size: sp(11)
			halign: "right"
			text_size: self.size
			valign: "middle"
			opacity: 1 if root.shared_text else 0

<SavingsSummaryRow@BoxLayout>:
	label_text: ""
	amount_text: "0.00"
	amount_color: rgba("#0EA5E9FF")
	size_hint_y: None
	height: dp(32)
	padding: [dp(12),0]
	spacing: dp(12)
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.5)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [10,10,10,10]
	Label:
		text: root.label_text
		color: rgba("#E2E8F0FF")
		font_size: sp(14)
		halign: "left"
		valign: "middle"
		text_size: self.size
	Label:
		text: root.amount_text
		color: root.amount_color
		font_size: sp(14)
		bold: True
		halign: "right"
		valign: "middle"
		text_size: self.size


<CategorySummaryRow@BoxLayout>:
	category_text: ""
	amount_text: ""
	amount_color: rgba("#FFFFFF")
	budget_text: ""
	variance_text: "0.00"
	variance_color: rgba("#FFFFFF")
	screen_name: "category_totals"
	orientation: "horizontal"
	size_hint_y: None
	height: dp(30)
	padding: [dp(16),dp(12)]
	spacing: dp(16)
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.6)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [14,14,14,14]
	Label:
		text: root.category_text
		color: rgba("#E2E8F0FF")
		font_size: sp(14)
		bold: True
		halign: "left"
		valign: "middle"
		text_size: self.size
		size_hint_x: 0.4
	Label:
		text: root.amount_text
		color: root.amount_color
		font_size: sp(13)
		bold: True
		size_hint_x: 0.2
		halign: "left"
		valign: "middle"
		text_size: self.size
	TextInput:
		size_hint_x: None
		size_hint_y: None
		width: dp(88)
		height: dp(24)
		text: root.budget_text
		hint_text: "Budget"
		background_color: rgba("#1E293BFF")
		foreground_color: rgba("#E2E8F0FF")
		cursor_color: rgba("#38BDF8FF")
		padding: [dp(8), dp(4)]
		radius: [12,12,12,12]
		font_size: sp(12)
		input_filter: "float"
		multiline: False
		write_tab: False
		halign: "center"
		on_focus:	
			(app.root.get_screen(root.screen_name).handle_budget_input(root.category_text, self.text) if app.root and not self.focus else None )
		on_text_validate:
			(app.root.get_screen(root.screen_name).handle_budget_input(root.category_text, self.text) if app.root else None)
	Label:
		text: root.variance_text
		color: root.variance_color
		font_size: sp(13)
		bold: True
		size_hint_x: 0.2
		halign: "right"
		valign: "middle"
		text_size: self.size

<DashboardScreen>:
	name: "dashboard"
	BoxLayout:
		orientation: "horizontal"
		NavigationDrawer:
		BoxLayout:
			orientation: "vertical"
			canvas.before:
				Color:
					rgba: rgba("#0B1020FF")
				Rectangle: 
					pos: self.pos
					size: self.size
			TopAppBar:
			ScrollView:
				do_scroll_x: False
				GridLayout:
					cols:1
					size_hint_y: None
					height: self.minimum_height
					padding: dp(24)
					spacing: dp(24)
					GridLayout:
						cols:3
						size_hint_y: None
						height: dp(160)
						spacing: dp(18)
						MetricCard:
							metric_title: "Current Balance"
							metric_value: root.current_balance_text
							metric_caption: root.balance_caption
							bg_color: rgba("#1E293BFF")
						MetricCard:
							metric_title: "Outstanding Debt"
							metric_value: root.outstanding_debt_text
							metric_caption: root.outstanding_debt_caption
							bg_color: rgba("#7C3AEDFF")
					BoxLayout:
						orientation: "horizontal"
						size_hint_y: None
						height: dp(64)
						padding: [20,0,20,0]
						spacing: dp(16)
						AnchorLayout:
							anchor_x: "left"
							anchor_y: "center"
							AccentButton:
								text: "Add expense"
								background_color: rgba("#EF5250FF")
								size_hint: None, None
								size: dp(180), dp(50)
								on_release: app.root.get_screen("dashboard").open_add_expense()
						AnchorLayout:
							anchor_x: "right"
							anchor_y: "center"
							AccentButton:
								text: "Add Income"
								background_color: rgba("#66BB6AFF")
								size_hint: None, None
								size: dp(180), dp(50)
								on_release: app.root.get_screen("dashboard").open_add_income()						


<CategoryTotalsScreen>:
	name: "category_totals"
	category_summary: []
	BoxLayout:
		orientation: "horizontal"
		NavigationDrawer:
		BoxLayout:
			orientation: "vertical"
			canvas.before:
				Color:
					rgba: rgba("#0B1020FF")
				Rectangle:
					pos: self.pos
					size: self.size
			TopAppBar:
			BoxLayout:
				orientation: "vertical"
				padding: dp(14)
				spacing: dp(18)
				size_hint_y: None
				height: dp(10)
				Label:
					text: "Category Totals"
					color: rgba("#FFFFFF")
					font_size: sp(12)
					bold: True
					halign: "left"
					valign: "middle"
					text_size: self.size
			BoxLayout:
				orientation: "vertical"
				padding: dp(10)
				spacing: dp(8)
				RecycleView:
					viewclass: "CategorySummaryRow"
					data: root.category_summary
					bar_width: dp(6)
					scroll_wheel_distance : dp(120)
					RecycleBoxLayout:
						default_size: None, dp(50)
						default_size_hint: 1, None
						size_hint_y: None
						height: self.minimum_height
						orientation: "vertical"
						spacing: dp(10)


<TransactionsScreen>:
	name: "transactions"
	rv: transactions_rv
	empty_label: empty_level
	filter_text_input: filter_text
	filter_device_input: filter_device
	filter_category_input: filter_category
	BoxLayout:
		orientation: "vertical"
		canvas.before:
			Color:
				rgba: rgba("#0B1020FF")
			Rectangle:
				pos: self.pos
				size: self.size
		TopAppBar:
			Button:
				size_hint:	None, None
				size: dp(44), dp(44)
				text: "<-"
				font_name: "DejaVuSans.ttf"
				font_size: sp(20)
				background_normal: ""
				background_color: 0,0,0,0
				color: rgba("#E2E8F0FF")
				on_release: app.root.current = "dashboard"
			Label:
				text: "Transactions"
				color: rgba("#fff1d6")
				font_size: sp(20)
				bold: True
				text_size: self.size
				halign: "left"
				valigh: "middle"
		BoxLayout:
			orientation: "vertical"
			padding: dp(24)
			spacing: dp(16)
			BoxLayout:
				size_hint_y: None
				height: dp(44)
				spacing: dp(12)
				TextInput:
					id: filter_text
					hint_text: "Search description / category / device"
					background_color: rgba("#1E293BFF")
					foreground_color: rgba("#E2E8F0FF")
					padding: dp(12)
					radius: [12,12,12,12]
					multiline: False
					on_text_validate: root.refresh()
				TextInput:
					id: filter_category
					hint_text: "Category"
					background_color: rgba("#1E293BFF")
					foreground_color: rgba("#E2E8F0FF")
					padding: dp(12)
					radius: [12,12,12,12]
					size_hint_x: None
					width: dp(120)
					multiline: False
					on_text_validate: root.refresh()
				TextInput:
					id: filter_device
					hint_text: "Device"
					background_color: rgba("#1E293BFF")
					foreground_color: rgba("#E2E8F0FF")
					padding: dp(12)
					radius: [12,12,12,12]
					size_hint_x: None
					width: dp(110)
					multiline: False
					on_text_validate: root.refresh()
				Button:
					text: "Clear"
					size_hint_x: None
					width: dp(80)
					background_color: rgba("#475569FF")
					color: rgba("#FFFFFF")
					on_release: root.clear_filters()
			Label:
				id: empty_level
				text: "No transactions yet, Add your first expense"
				opacity: 0
				size_hint_y: None
				height: 0
				color: rgba("#94A3B8FF")
				font_size: sp(14)
				halign: "center"
				valigh: "middle"
			RecycleView:
				id: transactions_rv
				viewclass: "TransactionRow"
				bar_width: dp(6)
				scroll_wheel_distance: dp(20)
				effect_cls: "ScrollEffect"
				RecycleBoxLayout:
					default_size: None, dp(72)
					default_size_hint: 1, None
					size_hint_y: None
					height: self.minimum_height
					orientation: "vertical"
					spacing: dp(12)

<NetWorthScreen>:
	name: "networth"
	BoxLayout:
		orientation: "vertical"
		canvas.before:
			Color:
				rgba: rgba("#0B1020FF")
			Rectangle:
				pos: self.pos
				size: self.size
		TopAppBar:
			Button:
				size_hint: None,None
				size: dp(44), dp(44)
				text: "<-"
				font_name: "DejaVuSans.ttf"
				font_size: sp(20)
				background_normal: ""
				background_color: 0,0,0,0
				color: rgba("#E2E8F0FF")
				on_release: app.root.current = "dashboard"
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols:1
				size_hint_y: None
				height: self.minimum_height
				padding : [dp(24), dp(18), dp(24), dp(24)]
				spacing: dp(18)
				Label:
					text: "Net Worth overview"
					font_size: sp(20)
					color: rgba("#FFFFFF")
					bold: True
					size_hint_y: None
					height: self.texture_size[1]
				BoxLayout:
					orientation: "horizontal"
					spacing: dp(16)
					size_hint_y: None
					height: dp(150)
					MetricCard:
						metric_title: "Liquid Balance"
						metric_value: root.liquid_balance_text
						metric_caption: root.liquid_balance_caption
						bg_color: rgba("#1E293BFF")
					MetricCard:
						metric_title: "Outstanding Debt"
						metric_value: root.outstanding_debt_text
						metric_caption: root.outstanding_debt_caption
						bg_color: rgba("#1E293BFF")
					MetricCard:
						metric_title: "Total Savings"
						metric_value: root.total_savings_text
						metric_caption: "Savings Rd/FD"
						bg_color: rgba("#1E293BFF")
				BoxLayout:
					orientation: "horizontal"
					spacing: dp(2)
					size_hint_y: None
					height: dp(200)
					GlassCard:
						size_hint_y:None
						height: dp(200)
						padding: dp(14)
						spacing: dp(12)
						size_hint_x: 0.55
						Label:
							text: "Savings Summary"
							size_hint_y: None
							height: self.texture_size[1]
							color: rgba("#E0F2FEFF")
							bold:True
						Label:
							text: root.total_savings_text if root.savings_summary else "No savings transactions yet"
							color: rgba("#94A3B8FF") if not root.savings_summary else rgba("#FFFFFF")
							size_hint_y: None
							height: dp(24)
							bold:True if root.savings_summary else False
						RecycleView:
							viewclass: "SavingsSummaryRow"
							data: root.savings_summary
							bar_width: dp(6)
							scroll_wheel_distance: dp(120)
							size_hint_y: 1
							RecycleBoxLayout:
								default_size: None, dp(36)
								default_size_hint: 1, None
								size_hint_y: None
								height: self.minimum_height
								orientation: "vertical"
								spacing: dp(8)
<SettingsScreen>:
	name: "settings"
	initial_balance_input: initial_balance_input
	initial_cash_input: initial_cash_input
	BoxLayout:
		orientation: "vertical"
		canvas.before:
			Color:
				rgba: rgba("#0B1020FF")
			Rectangle:
				pos: self.pos
				size: self.size
		TopAppBar:
		Button:
			size_hint: None, None
			size: dp(44), dp(44)
			text: "<-"
			font_name: "DejaVuSans.ttf"
			font_size: sp(20)
			background_normal: ""
			background_color: 0,0,0,0
			color: rgba("#E2E8F0FF")
			on_release: app.root.current = "dashboard"
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols:1 
				size_hint_y: None
				height: self.minimum_height
				padding: dp(24)
				spacing: dp(16)
				GlassCard:
					Label:
						text: "General"
						size_hint_y: None
						height: self.texture_size[1]
						color: rgba("#E0F2FEFF")
						bold: True
					GridLayout:
						cols:2
						spacing: dp(12)
						TextInput:
							id:	initial_balance_input
							multiline: False
							hint_text: "Initial Bank Balance"
							background_color: rgba("#1E293BFF")
							foreground_color: rgba("#E2E8F0FF")
							padding: dp(16)
							radius: [12,12,12,12]
						TextInput:
							id:	initial_cash_input
							hint_text: "Initial Cash Balance"
							background_color: rgba("#1E293BFF")
							foreground_color: rgba("#E2E8F0FF")
							padding: dp(16)
							radius: [12,12,12,12]
							multiline: False
					AnchorLayout:
						size_hint_y: None
						height: dp(44)
						anchor_x: "center"
						Button:
							text: "Save"
							size_hint: None, None
							size: dp(160), dp(44)
							background_color: rgba("#22C55EFF")
							color: rgba("#FFFFFF")
							on_release: root.save_settings()
		
		GridLayout:
			cols:3
			spacing: dp(12)
			padding: dp(20)
			Button:
				text: "Start New Month"
				size_hint_y: None
				height: dp(44)
				background_normal: ""
				background_color: rgba("#34D399FF")
				color: rgba("#0F172AFF")
				on_release: root.start_new_month()
			Button:
				text: "Clear Outstanding Debt"
				size_hint_y: None
				height: dp(44)
				background_normal: ""
				background_color: rgba("#F87171FF")
				color: rgba("#FFFFFF")
				on_release: root.clear_outstanding_debt()
			Button:
				text: "Edit Initial Savings"
				size_hint_y: None
				height: dp(44)
				background_normal: ""
				background_color: rgba("#60A5FAFF")
				color: rgba("#0F172AFF")
				on_release: root.open_initial_savings_dialog()
		

<SharedExpensesScreen>:
	name: "shared_expenses"
	summary_data: []
	detail_data: []
	participant_input: participant_input
	category_input: category_input
	BoxLayout:
		orientation: "vertical"
		canvas.before:
			Color:
				rgba: rgba("#0B1020FF")
			Rectangle:
				pos: self.pos
				size: self.size
		TopAppBar:
		Button:
			size_hint: None,None
			size: dp(44), dp(44)
			text: "<-"
			font_name: "DejaVuSans.ttf"
			font_size: sp(20)
			background_normal: ""
			background_color: 0,0,0,0
			color: rgba("#E2E8F0FF")
			on_release: app.root.current = "dashboard"
		ScrollView:
			do_scroll_x: False
			GridLayout:
				cols: 1
				padding: dp(24)
				spacing: dp(16)
				size_hint_y: None
				height: self.minimum_height
				Label:
					text: "Shared Expenses"
					color: rgba("#FFFFFF")
					font_size: sp(20)
					bold: True
				Label:
					text: root.filters_caption
					color: rgba("#94A3B8FF")
					font_size: sp(12)
					size_hint_y: None
					height: dp(18)
				BoxLayout:
					orientation: "horizontal"
					spacing: dp(12)
					size_hint_y: None
					height: dp(48)
					TextInput:
						id: participant_input
						hint_text: "Participant name"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: [dp(12), dp(10)]
						size_hint_y: None
						height: dp(44)
						radius: [12,12,12,12]
						multiline: False
						on_text_validate: root.handle_filter_change()
					TextInput:
						id: category_input
						hint_text: "Category"
						background_color: rgba("#1E293BFF")
						foreground_color: rgba("#E2E8F0FF")
						padding: [dp(12), dp(10)]
						size_hint_y: None
						height: dp(44)
						radius: [12,12,12,12]
						multiline: False
						on_text_validate: root.handle_filter_change()
					Button:
						text: "Apply"
						size_hint_x: None
						width: dp(90)
						on_release: root.handle_filter_change()
						background_color: rgba("#22C55EFF")
						color: rgba("#0F172AFF")
					Button:
						text: "Clear"
						size_hint_x: None
						width: dp(90)
						on_release: root.clear_filters()
						background_color: rgba("#475569FF")
						color: rgba("#FFFFFF")
				GridLayout:
					cols: 2
					spacing: dp(12)
					size_hint_y: None
					height: dp(150)
					row_default_height: dp(140)
					row_force_default: True
					MetricCard:
						metric_title: "Total shared"
						metric_value: root.total_shared_text
						metric_caption: root.filters_caption
						bg_color: rgba("#1F2937FF")
					MetricCard:
						metric_title: root.summary_caption
						metric_value: root.detail_caption
						metric_caption: "Updated from your splits"
						bg_color: rgba("#111827FF")
				GlassCard:
					size_hint_y: None
					height: max(self.minimum_height, dp(200))
					BoxLayout:
						size_hint_y: None
						height: dp(28)
						Label:
							text: "Per-person summary"
							color: rgba("#E2E8F0FF")
							font_size: sp(14)
							bold: True
						Label:
							text: root.summary_caption
							color: rgba("#94A3B8FF")
							font_size: sp(12)
							halign: "right"
							text_size: self.size
					RecycleView:
						viewclass: "SharedSummaryRow"
						data: root.summary_data
						bar_width: dp(4)
						scroll_wheel_distance: dp(80)
						RecycleBoxLayout:
							default_size: None, dp(36)
							default_size_hint: 1, None
							size_hint_y: None
							height: self.minimum_height
							orientation: "vertical"
				GlassCard:
					size_hint_y: None
					height: max(self.minimum_height, dp(420))
					BoxLayout:
						size_hint_y: None
						height: dp(28)
						Label:
							text: "Transaction details"
							color: rgba("#E2E8F0FF")
							font_size: sp(14)
							bold: True
						Label:
							text: root.detail_caption
							color: rgba("#94A3B8FF")
							font_size: sp(12)
							halign: "right"
							text_size: self.size
					RecycleView:
						viewclass: "SharedDetailRow"
						data: root.detail_data
						bar_width: dp(4)
						scroll_wheel_distance: dp(80)
						RecycleBoxLayout:
							default_size: None, dp(88)
							default_size_hint: 1, None
							size_hint_y: None
							height: self.minimum_height
							orientation: "vertical"

<SharedDetailRow@BoxLayout>:
	date_text: ""
	category_text: ""
	description_text: ""
	amount_text: ""
	participants_text: ""
	notes_text: ""
	share_text: ""
	orientation: "vertical"
	size_hint_y: None
	height: max(self.minimum_height, dp(110))
	padding: dp(16)
	spacing: dp(6)
	canvas.before:
		Color:
			rgba: (26/255, 32/255, 45/255, 0.7)
		RoundedRectangle:
			pos: self.pos
			size: self.size
			radius: [12,12,12,12]
	BoxLayout:
		size_hint_y: None
		height: dp(26)
		orientation: "horizontal"
		Label:
			text: root.category_text if root.category_text else root.date_text
			color: rgba("#A5B4FCFF")
			font_size: sp(12)
			valign: "middle"
			text_size: self.size
			size_hint_x: 0.55
		Label:
			text: f"{root.date_text}   {root.amount_text}"
			color: rgba("#FBBF24FF")
			font_size: sp(13)
			bold: True
			halign: "right"
			valign: "middle"
			text_size: self.size
			size_hint_x: 0.45
	Label:
		text: root.description_text
		color: rgba("#FFFFFF")
		font_size: sp(13)
		bold: True
	Label:
		text: root.participants_text
		color: rgba("#FACC15FF")
		font_size: sp(12)
		text_size: self.width, None
		size_hint_y: None
		height: self.texture_size[1] if self.texture_size[1] > 0 else dp(16)
	Label:
		text: root.share_text
		color: rgba("#86EFACFF")
		font_size: sp(12)
		text_size: self.width, None
		size_hint_y: None
		height: dp(16) if root.share_text else 0
	Label:
		text: root.notes_text or ""
		color: rgba("#94A3B8FF")
		font_size: sp(11)
		text_size: self.size
		valign: "top"

MoneyTrackerScreenManager:
	DashboardScreen:
	TransactionsScreen:
	CategoryTotalsScreen:
	SettingsScreen:
	NetWorthScreen:
	SharedExpensesScreen:
